1) Мета
Мобільний «тупий» сканер для складу під Odoo 15: працівник із телефона + HID-сканер (як клавіатура з Enter) сканує лише штрихкоди товарів (артикул у ШК) у призначеному замовленні. На екрані — одна дія, дуже великий текст, мінімум варіантів.

2) Жорсткі обмеження MVP
Потік: Вхід (бейдж+PIN) → Прив’язати замовлення → Сканувати товари → Наклеїти ТТН → Затвердити. - ось тут можна краще так: один раз логін через імейл+пароль, далі вхід просто через пін на своєму тел.


Меню немає. Ручний ввід — тільки PIN.


Одиниці виміру — штучні (без ваги/дробів у MVP).


Лоти/серії — виключені в MVP (додамо пізніше).


Буфер локальний: усі скани йдуть у локальний список; при фінальному підтвердженні — звірка з Odoo.


При невідповідності кількостей на етапі підтвердження — збірка скасовується й показується повідомлення, що замовлення змінилося.


Скасування збірки доступне з екрану сканування: обнуляє локальні кількості без зміни статусу замовлення в Odoo.



3) Авторизація та безпека
Етап 1: Скан бейджа працівника → бекенд повертає ім’я + флаг «активний/архівований».


Етап 2: PIN (персональний, 4–6 цифр).


Успіх → видається токен сесії (TTL 8 год) та device_id (див. нижче).


Якщо акаунт у Odoo архівований: бекенд повертає 403 ARCHIVED. Застосунок:


блокує інтерфейс («Акаунт деактивовано»),


очищує локальні дані/буфери/токен,


пропонує закрити застосунок; при наступному відкритті — тільки екран входу.
 (Технічно «самовидалення» для PWA неповне; робимо повне блокування + очищення пам’яті.)


Device binding: при першому вході застосунок генерує device_id і надсилає на бекенд; бекенд зберігає прив’язку користувач↔пристрій. Токен видається на user+device.



4) Екрани (одна дія на екран, великі шрифти)
4.1. Вхід
«СКАНУЙТЕ БЕЙДЖ»
 Підпис: «Піднесіть сканер до штрихкоду бейджа».
 Помилка: червоний екран «БЕЙДЖ НЕ ВПІЗНАНО. СКАНУЙТЕ ЩЕ РАЗ».


«ВВЕДІТЬ PIN»
 Великий цифровий ввод (тільки цифри).
 Помилка: «НЕВІРНИЙ PIN».


Після успіху — короткий зелений спалах «ГОТОВО» → авто-перехід.
4.2. Прив’язати замовлення
«СКАНУЙ НАКЛАДНУ (OUT…)»
 Помилка: «НЕ ТА НАКЛАДНА. СКАНУЙ ПРАВИЛЬНУ».
Успіх → відразу показує перший рядок для сканування.
4.3. Сканування товарів (головний процес)
Зверху дуже крупно номер замовлення (OUT…).
 Далі: «СКАНУЙ: <SKU / НАЗВА>»
 Під цим: «ЗАЛИШОК: 3 ВЖЕ: 2 ПОТРІБНО ВСЬОГО: 5» (величезні цифри на пів екрана).
 Внизу дрібним: «Тільки скан товару або ВІДМІНА ЗБІРКИ».
Події:
Валідний код потрібного товару → +1, зелений спалах, звук «наступний товар».


Перевищення потрібної кількості → червоний екран, звук «це лишній товар».


Код товару, якого немає в замовленні → червоний екран, звук «цього товару немає».


Коли рядок закрито (залишок 0) → зелений екран «ГОТОВО. ДАЛІ» → автоперехід на наступний рядок.
Коли всі рядки закриті → зелений екран «ЗАМОВЛЕННЯ ЗІБРАНО», звук «останній товар».
Кнопка внизу (велика): «НАКЛІЙТЕ ТТНки НА ТОВАРИ, x ШТУК»
 Поруч велика кнопка: «НАКЛІЄНО x ШТУК» (після натискання стає зеленою «ГОТОВО»).
Далі велика кнопка: «ЗАТВЕРДИТИ ЦЕ ЗАМОВЛЕННЯ (OUT…)»
 Натискання запускає остаточну валідацію з Odoo:
Якщо все співпадає → бекенд фіксує скани (не змінюючи небажані статуси за межами ТЗ) і повертає ok. Екран: «НЕСИ НА УПАКУВАННЯ».


Якщо кількості в Odoo змінилися → червоний екран:
 «ЗАМОВЛЕННЯ ЗМІНИЛОСЯ. Для тепер ПОТРІБНО: N. СКАНУЄМО ЗАНОВО».
 Локальні лічильники для позицій із розбіжностями обнуляються; повернення на екран сканування.


4.4. Відміна збірки
Велика окрема кнопка на екрані сканування: «ВІДМІНИТИ ЗБІРКУ»
 Підтвердження PIN (щоб не випадково). Результат:
Локальні кількості обнулені,


Статус замовлення в Odoo не змінюється,


Повернення до екрану «СКАНУЙ НАКЛАДНУ».



5) Звуки (4 події)
«Наступний товар» — короткий «ok-beep» при кожному валідному інкременті.


«Останній товар у замовленні» — довший позитивний сигнал (інший тон/мелодія).


«Лишній товар у замовленні» — різкий короткий «error-beep».


«Цього товару немає у замовленні» — трішки довший «error-beep» (відрізняється від п.3).



6) Локальний буфер і валідація
Кожен скан пишеться у локальний буфер: {barcode, product_id, +1, timestamp} і агрегація по рядках.


Кнопка «Затвердити» викликає бекенд-ендпоїнт /validate:


Бекенд читає поточну правду Odoo по замовленню і порівнює з локальними підсумками.


Якщо розбіжностей немає → підтверджує зібрані кількості (пише done по рядках/line_id) і повертає ok.


Якщо є → повертає список відмінностей по SKU/line_id з новою «ПОТРІБНО ВСЬОГО». Фронт показує повідомлення і відкидає локальні скани по цих позиціях до нуля (решта — зберігається).



7) Мінімальні API (бекенд Odoo, auth='user' + Bearer token)
POST /flf/api/v1/login_badge → { badge_barcode, device_id, pin }
 Відповідь:


200 { ok:true, token, user:{id,name,active:true}, device_id }


або 403 { ok:false, error:'ARCHIVED' }


або 401 { ok:false, error:'BADGE_OR_PIN' }


POST /flf/api/v1/task/attach → { picking_barcode }
 200 { ok:true, picking:{id,name}, line:{ line_id, product_id, product_name, required, done, remain }, order_summary }
 (Бекенд одразу повертає мапу валідних штрихкодів для замовлення, або прозорий пошук по БД на кожному скані.)


POST /flf/api/v1/scan/item → { picking_id, barcode }
 Успіх (інкремент у локальному буфері фронту, бекенд лише валідує приналежність баркоду до замовлення/позиції):


200 { ok:true, line:{ required, done, remain }, row_completed?:true, order_completed?:false }
 Помилки:


409 { ok:false, error:'OVERPICK' } → «це лишній товар»


404 { ok:false, error:'NOT_IN_ORDER' } → «цього товару немає»


POST /flf/api/v1/validate → { picking_id, payload:[ {line_id, product_id, qty} ] }


200 { ok:true, labels_count:x }


409 { ok:false, error:'MISMATCH', diffs:[ {line_id, product_id, new_required} ] }


(Опційно) POST /flf/api/v1/cancel_local → нічого не змінює в Odoo; фронт сам обнуляє локально.


Примітка: у MVP /scan/item не пише done у Odoo. Запис у stock.move.line виконується лише у /validate (атомарно, транзакційно).

8) Дані в Odoo (мінімум)
Використовуємо стандартні stock.picking / stock.move / stock.move.line.


Додаємо технічні поля (необов’язково):


x_mobile_allowed_barcodes (кеш валідних ШК для швидкої перевірки),


x_bound_device_ids (історія прив’язок),


x_last_mobile_user_id, x_last_mobile_at (аудит).



9) Правила UX
Шрифти надвеликі (заголовки 120–200 px, цифри — «пів екрана»).


Фідбек «зелений/червоний» заповнює екран на 200–800 мс.


На екрані сканування є тільки: текст-інструкція, лічильники, велика кнопка «ВІДМІНИТИ ЗБІРКУ».


Після «ЗАМОВЛЕННЯ ЗІБРАНО»: великі кнопки «НАКЛІЄНО x ШТУК» → «ЗАТВЕРДИТИ ЦЕ ЗАМОВЛЕННЯ (OUT…)».



10) Обробка помилок і гонок
Якщо інший співробітник паралельно змінив замовлення → спрацює 409 MISMATCH на /validate.


Якщо замовлення стало неактивним/закритим → 409 {error:'ORDER_LOCKED'} і повернення на «СКАНУЙ НАКЛАДНУ».


Якщо токен прострочений → 401 → повернення на «СКАНУЙТЕ БЕЙДЖ».



11) Продуктивність і стабільність
Сканер як HID з суфіксом Enter.


Клавіатурний буфер у фронті з «пакетом» до Enter та таймаутом «тиші» 80 мс.


Анти-шум: мінімальна довжина коду 6, whitelist EAN-13/Code-128 (конфігурується).


Wake-Lock, автофокус прихованого input, відсутність прокрутки/жестів.



12) Критерії приймання
Вхід: скан бейджа + правильний PIN → успіх; архівований акаунт → блокування й очищення даних.


Прив’язка: скан OUT-накладної → перший рядок на екрані; зверху номер замовлення.


Валідні скани → інкремент «ВЖЕ», зменшення «ЗАЛИШОК», звук «наступний товар».


«Лишній товар» → не інкрементується, червоний екран + відповідний звук.


«Немає в замовленні» → червоний екран + свій звук.


Закриття останнього рядка → звук «останній товар», екран «ЗАМОВЛЕННЯ ЗІБРАНО».


Етап ТТН: є повідомлення «Наклійте ТТНки…, x штук» та кнопка «Наклієно x штук».


«Затвердити» робить звірку з Odoo:


Якщо все ок — повертає ok, показує «НЕСИ НА УПАКУВАННЯ».


Якщо ні — повідомлення «Замовлення змінилося…», позиції з розбіжностями скинуті на 0.


«Відмінити збірку» → локальні кількості обнулені, статус замовлення в Odoo без змін.



13) Мінімальні тести
Позитивний сценарій: позиція 5 шт → 5 валідних сканів → автоперехід до наступної; кінець — «ЗАМОВЛЕННЯ ЗІБРАНО» → «Затвердити» → ok.


Лишній скан: при 5/5 ще один скан → «це лишній товар».


Невірний товар: скан коду, якого немає в замовленні → «цього товару немає».


Міс-матч: перед «Затвердити» змінити кількість у Odoo → 409 MISMATCH і повідомлення.


Скасування: натиснути «Відмінити збірку» → буфер = 0, статус Odoo без змін.



Цього ТЗ достатньо, щоб швидко реалізувати у Windsurf: один сторінковий фронт + 3–4 простих ендпоїнти на Odoo. Коли MVP стабільно працюватиме — окремим етапом додамо лоти/серії, друк ZPL «в один тап», заміни SKU й ін.

